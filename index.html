<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProjectTrack | Single-File Deployment</title>

    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM (Development versions for better error messages) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for Browser Execution -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .drag-over {
            border-color: #6366f1 !important;
            background-color: #f5f3ff !important;
        }
    </style>
</head>

<body class="bg-slate-50">
    <div id="root"></div>

    <!-- We use type="text/babel" with data-type="module" to allow both JSX and Imports -->
    <script type="text/babel" data-type="module">
        // ==========================================
        // 1. FIREBASE CONFIGURATION (PASTE YOURS HERE)
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDESSKXtqR3D00-b_M7oBqbqOJ6GIzydJk",
            authDomain: "project-timeline-track.firebaseapp.com",
            projectId: "project-timeline-track",
            storageBucket: "project-timeline-track.firebasestorage.app",
            messagingSenderId: "910675827292",
            appId: "1:910675827292:web:8bebef089cc5d6b3e4e499"
        };
        const APP_ID = "production-tracker-01";

        // Check if config is still placeholder
        const isConfigValid = firebaseConfig.apiKey !== "YOUR_API_KEY";

        // Import Firebase via CDN Modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, updateDoc, doc, setDoc, serverTimestamp, query, orderBy, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        let app, auth, db;
        if (isConfigValid) {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        }

        // ==========================================
        // 2. SVG ICONS
        // ==========================================
        const Icons = {
            Layout: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1" /><rect width="7" height="5" x="14" y="3" rx="1" /><rect width="7" height="9" x="14" y="12" rx="1" /><rect width="7" height="5" x="3" y="16" rx="1" /></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="16" /><line x1="8" y1="12" x2="16" y2="12" /></svg>,
            Message: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z" /></svg>,
            Loader: () => <svg className="animate-spin" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="2" x2="12" y2="6" /><line x1="12" y1="18" x2="12" y2="22" /><line x1="4.93" y1="4.93" x2="7.76" y2="7.76" /><line x1="16.24" y1="16.24" x2="19.07" y2="19.07" /><line x1="2" y1="12" x2="6" y2="12" /><line x1="18" y1="12" x2="22" y2="12" /><line x1="4.93" y1="19.07" x2="7.76" y2="16.24" /><line x1="16.24" y1="7.76" x2="19.07" y2="4.93" /></svg>,
            Alert: () => <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ef4444" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></svg>
        };

        const SetupMessage = () => (
            <div className="h-screen flex flex-col items-center justify-center p-6 bg-slate-50 text-center">
                <Icons.Alert />
                <h2 className="mt-4 text-2xl font-black text-slate-800">Firebase Config Required</h2>
                <p className="mt-2 text-slate-600 max-w-md leading-relaxed">
                    The errors you are seeing (<b>api-key-not-valid</b> and <b>permission-denied</b>) occur because you haven't added your own Firebase credentials to the file.
                </p>
                <div className="mt-8 bg-white p-6 rounded-2xl shadow-xl border border-slate-200 text-left w-full max-w-lg">
                    <p className="font-bold text-sm text-indigo-600 mb-2 uppercase tracking-widest">How to fix:</p>
                    <ol className="list-decimal list-inside space-y-3 text-sm text-slate-700">
                        <li>Go to your <a href="https://console.firebase.google.com/" target="_blank" className="text-indigo-600 underline">Firebase Console</a>.</li>
                        <li>Project Settings &gt; General &gt; Your Apps &gt; SDK Setup & Config.</li>
                        <li>Copy the <b>apiKey, projectId, etc.</b></li>
                        <li>Paste them into the <code>firebaseConfig</code> object at the top of this script.</li>
                        <li>Ensure <b>Anonymous Auth</b> is enabled in the Firebase Auth tab.</li>
                    </ol>
                </div>
            </div>
        );

        const Navbar = ({ view, setView }) => (
            <nav className="bg-white/80 backdrop-blur-md border-b border-slate-200 px-4 md:px-8 py-4 flex items-center justify-between sticky top-0 z-50">
                <div className="flex items-center gap-3">
                    <div className="bg-indigo-600 p-2 rounded-xl text-white shadow-lg">
                        <Icons.Layout />
                    </div>
                    <h1 className="font-black text-xl tracking-tight text-slate-800">Project<span className="text-indigo-600">Track</span></h1>
                </div>
                <div className="flex gap-2 bg-slate-100 p-1 rounded-xl border border-slate-200">
                    <button onClick={() => setView('board')} className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${view === 'board' ? 'bg-white text-indigo-700 shadow-sm' : 'text-slate-500'}`}>Track</button>
                    <button onClick={() => setView('overview')} className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${view === 'overview' ? 'bg-white text-indigo-700 shadow-sm' : 'text-slate-500'}`}>Logs</button>
                    <button onClick={() => setView('settings')} className={`p-2 rounded-lg ${view === 'settings' ? 'bg-white text-indigo-700 shadow-sm' : 'text-slate-500'}`}><Icons.Settings /></button>
                </div>
            </nav>
        );

        const BoardView = ({ projects, checkpoints, onDrop, onOpenNote }) => (
            <div className="relative mt-16 pb-20 overflow-x-auto">
                <div className="relative min-w-[1000px] md:min-w-full pt-12">
                    <div className="absolute top-[60px] left-0 w-full h-[2px] bg-slate-200" style={{ zIndex: 0 }}>
                        <div className="h-full bg-indigo-500 w-full" />
                    </div>
                    <div className="relative flex justify-between">
                        {checkpoints.map((checkpoint) => (
                            <div
                                key={checkpoint}
                                onDragOver={(e) => e.preventDefault()}
                                onDrop={(e) => {
                                    const id = e.dataTransfer.getData("projectId");
                                    onDrop(id, checkpoint);
                                }}
                                className="relative flex flex-col items-center group w-full"
                            >
                                <div className="absolute -top-10 text-center w-full">
                                    <span className="text-[10px] font-black uppercase tracking-widest text-slate-400">{checkpoint}</span>
                                </div>
                                <div className={`z-10 w-6 h-6 rounded-full border-4 transition-all ${projects.some(p => p.status === checkpoint) ? 'bg-indigo-600 border-indigo-100 scale-125' : 'bg-white border-slate-200'}`} />
                                <div className="mt-12 w-full flex flex-col items-center gap-4 px-2 min-h-[400px]">
                                    {projects.filter(p => p.status === checkpoint).map((project) => (
                                        <div
                                            key={project.id}
                                            draggable
                                            onDragStart={(e) => e.dataTransfer.setData("projectId", project.id)}
                                            className="w-full max-w-[240px] bg-white p-4 rounded-2xl shadow-sm border-2 border-slate-100 hover:border-indigo-400 cursor-grab active:cursor-grabbing"
                                        >
                                            <div className="flex justify-between items-start mb-2">
                                                <span className="text-[9px] font-black text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded uppercase">{project.version}</span>
                                                <button onClick={() => onOpenNote(project.id)} className="text-slate-300 hover:text-indigo-500"><Icons.Message /></button>
                                            </div>
                                            <h3 className="font-bold text-slate-800 text-sm leading-tight">{project.name}</h3>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        const App = () => {
            const [view, setView] = React.useState('board');
            const [projects, setProjects] = React.useState([]);
            const [checkpoints] = React.useState(["Backlog", "Design", "Dev", "UAT", "Live"]);
            const [loading, setLoading] = React.useState(isConfigValid);
            const [user, setUser] = React.useState(null);

            React.useEffect(() => {
                if (!isConfigValid) return;

                const unsubAuth = onAuthStateChanged(auth, (u) => {
                    if (!u) signInAnonymously(auth).catch(err => console.error("Auth Error:", err));
                    setUser(u);
                });

                const q = query(collection(db, 'artifacts', APP_ID, 'public', 'data', 'projects'), orderBy('createdAt', 'desc'));
                const unsubProj = onSnapshot(q, (snap) => {
                    setProjects(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                    setLoading(false);
                }, (err) => {
                    console.error("Firestore Error:", err);
                    setLoading(false);
                });

                return () => { unsubAuth(); unsubProj(); };
            }, []);

            if (!isConfigValid) return <SetupMessage />;
            if (loading) return <div className="h-screen flex items-center justify-center"><Icons.Loader className="text-indigo-600" /></div>;

            const handleDrop = async (projectId, newStatus) => {
                const project = projects.find(p => p.id === projectId);
                if (!project || project.status === newStatus) return;
                try {
                    await updateDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'projects', projectId), {
                        status: newStatus,
                        updatedAt: serverTimestamp(),
                        history: arrayUnion({ type: 'status_change', from: project.status, to: newStatus, timestamp: new Date().toISOString() })
                    });
                } catch (e) { console.error("Update failed:", e); }
            };

            return (
                <div className="min-h-screen">
                    <Navbar view={view} setView={setView} />
                    <main className="px-4 md:px-8 max-w-[1400px] mx-auto">
                        {view === 'board' && <BoardView projects={projects} checkpoints={checkpoints} onDrop={handleDrop} onOpenNote={(id) => alert('Audit feature is in progress.')} />}
                        {view === 'overview' && <div className="py-20 text-center text-slate-400 font-bold uppercase tracking-widest">Audit Logs</div>}
                        {view === 'settings' && <div className="py-20 text-center text-slate-400 font-bold uppercase tracking-widest">Project Settings</div>}
                    </main>
                    <button
                        onClick={() => {
                            const name = prompt("Project Name:");
                            const version = prompt("Version:");
                            if (name && version) {
                                addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'projects'), {
                                    name, version, status: checkpoints[0], createdAt: serverTimestamp(), updatedAt: serverTimestamp()
                                });
                            }
                        }}
                        className="fixed bottom-8 right-8 bg-slate-900 text-white p-4 rounded-full shadow-2xl hover:scale-110 transition-all flex items-center justify-center"
                    >
                        <Icons.Plus />
                    </button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
